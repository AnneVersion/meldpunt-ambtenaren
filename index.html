<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'><rect y='0' width='36' height='12' fill='%23AE1C28'/><rect y='12' width='36' height='12' fill='%23FFF'/><rect y='24' width='36' height='12' fill='%2321468B'/></svg>">
<title>Meldpunt Ambtenaren — Wil jij je recht halen?</title>
<meta name="description" content="Wij helpen je om de daders verantwoordelijk te houden. Meld ambtenaren die burgers benadelen. Anoniem of openbaar.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300..800;1,9..40,300..800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
<style>
:root {
  --bg: #0a0e1a;
  --bg2: #111827;
  --bg3: #1e293b;
  --surface: rgba(30,41,59,.65);
  --glass: rgba(30,41,59,.45);
  --glass-bd: rgba(148,163,184,.15);
  --tx: #f1f5f9;
  --tx2: #94a3b8;
  --tx3: #64748b;
  --accent: #ef4444;
  --accent2: #dc2626;
  --accent-soft: rgba(239,68,68,.12);
  --blue: #3b82f6;
  --blue-soft: rgba(59,130,246,.12);
  --green: #22c55e;
  --green-soft: rgba(34,197,94,.12);
  --yellow: #eab308;
  --yellow-soft: rgba(234,179,8,.12);
  --purple: #a855f7;
  --purple-soft: rgba(168,85,247,.12);
  --r: 14px;
  --rs: 8px;
  --font: 'DM Sans', system-ui, sans-serif;
  --max-w: 860px;
  --tr: .2s cubic-bezier(.4,0,.2,1);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body { font-family: var(--font); background: var(--bg); color: var(--tx); line-height: 1.6; min-height: 100vh; -webkit-font-smoothing: antialiased; }
a { color: var(--blue); text-decoration: none; }
a:hover { text-decoration: underline; }
.mi { font-family: 'Material Icons Round'; font-size: 20px; vertical-align: -4px; }
.mi-sm { font-size: 16px; vertical-align: -3px; }

/* LAYOUT */
.shell { display: flex; flex-direction: column; min-height: 100vh; }
.top {
  position: sticky; top: 0; z-index: 100;
  background: rgba(10,14,26,.88);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--glass-bd);
  padding: 0 20px;
}
.top-inner {
  max-width: var(--max-w); margin: 0 auto;
  display: flex; align-items: center; height: 54px; gap: 8px;
}
.logo { font-weight: 700; font-size: 16px; cursor: pointer; display: flex; align-items: center; gap: 7px; white-space: nowrap; }
.logo .mi { color: var(--accent); font-size: 24px; }
.logo b { color: var(--accent); }
.spacer { flex: 1; }
.nav-links { display: flex; gap: 4px; align-items: center; }
.nav-btn {
  padding: 6px 14px; border-radius: var(--rs); font: 500 13px var(--font);
  color: var(--tx2); cursor: pointer; border: none; background: none;
  transition: var(--tr); display: flex; align-items: center; gap: 5px; white-space: nowrap;
}
.nav-btn:hover { color: var(--tx); background: var(--glass); }
.nav-btn.active { color: var(--tx); background: var(--surface); }
.nav-btn.cta { background: var(--accent); color: #fff; font-weight: 600; }
.nav-btn.cta:hover { background: var(--accent2); }

.hamburger { display: none; background: none; border: none; color: var(--tx); cursor: pointer; padding: 4px; }
@media(max-width:700px){
  .hamburger { display: block; }
  .nav-links { display: none; position: absolute; top: 54px; left: 0; right: 0; background: rgba(10,14,26,.95); backdrop-filter: blur(16px); flex-direction: column; padding: 12px; border-bottom: 1px solid var(--glass-bd); gap: 4px; }
  .nav-links.open { display: flex; }
  .nav-btn { width: 100%; justify-content: flex-start; padding: 10px 16px; }
}

.main { flex: 1; max-width: var(--max-w); margin: 0 auto; padding: 24px 20px 60px; width: 100%; }
.footer { background: var(--bg2); border-top: 1px solid var(--glass-bd); padding: 20px; text-align: center; font-size: 11px; color: var(--tx3); }

/* CARDS */
.card { background: var(--surface); border: 1px solid var(--glass-bd); border-radius: var(--r); padding: 20px; backdrop-filter: blur(8px); transition: var(--tr); }
.card:hover { border-color: rgba(148,163,184,.25); }
.card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 14px; }

/* BUTTONS */
.btn {
  display: inline-flex; align-items: center; gap: 6px; padding: 10px 20px;
  border-radius: var(--rs); font: 600 13px var(--font); cursor: pointer;
  border: 1px solid transparent; transition: var(--tr);
}
.btn-red { background: var(--accent); color: #fff; }
.btn-red:hover { background: var(--accent2); }
.btn-ghost { background: var(--glass); color: var(--tx); border-color: var(--glass-bd); }
.btn-ghost:hover { background: var(--surface); }
.btn-blue { background: var(--blue); color: #fff; }
.btn-blue:hover { background: #2563eb; }
.btn-purple { background: var(--purple); color: #fff; }
.btn-purple:hover { background: #9333ea; }
.btn-sm { padding: 6px 14px; font-size: 12px; }
.btn-lg { padding: 14px 28px; font-size: 15px; }

/* FORMS */
.fg { margin-bottom: 16px; }
.fl { display: block; font: 600 11px var(--font); color: var(--tx2); margin-bottom: 5px; text-transform: uppercase; letter-spacing: .5px; }
.fi, .fs, .ft {
  width: 100%; padding: 10px 14px; background: var(--bg2);
  border: 1px solid var(--glass-bd); border-radius: var(--rs);
  color: var(--tx); font: 400 14px var(--font); transition: var(--tr); outline: none;
}
.fi:focus, .fs:focus, .ft:focus { border-color: var(--blue); box-shadow: 0 0 0 3px var(--blue-soft); }
.ft { min-height: 120px; resize: vertical; }
.fhint { font-size: 11px; color: var(--tx3); margin-top: 4px; }
.fcheck { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: var(--tx2); }
.fcheck input { width: 18px; height: 18px; accent-color: var(--accent); cursor: pointer; }

/* BADGES */
.badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
.badge-red { background: var(--accent-soft); color: var(--accent); }
.badge-blue { background: var(--blue-soft); color: var(--blue); }
.badge-green { background: var(--green-soft); color: var(--green); }
.badge-yellow { background: var(--yellow-soft); color: var(--yellow); }
.badge-purple { background: var(--purple-soft); color: var(--purple); }

/* MELDING CARDS */
.m-card { cursor: pointer; }
.m-card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,.3); }

/* PAGE TRANSITION */
.page { animation: fadeIn .25s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

/* TOAST */
.toast-box { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
.toast { background: var(--surface); border: 1px solid var(--glass-bd); backdrop-filter: blur(12px); padding: 10px 18px; border-radius: var(--rs); font-size: 13px; color: var(--tx); box-shadow: 0 8px 32px rgba(0,0,0,.3); animation: tIn .3s ease; max-width: 340px; }
.toast.out { animation: tOut .3s ease forwards; }
@keyframes tIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes tOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }

/* EMPTY */
.empty { text-align: center; padding: 48px 20px; color: var(--tx3); }
.empty .mi { font-size: 48px; display: block; margin-bottom: 12px; opacity: .4; }

/* RESPONSIVE */
@media(max-width:600px){
  .main { padding: 16px 12px 40px; }
  .card { padding: 14px; }
  .card-grid { grid-template-columns: 1fr; }
}

/* SEARCH */
.search-wrap { position: relative; margin-bottom: 16px; }
.search-wrap .mi { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--tx3); font-size: 18px; }
.search-input { width: 100%; padding: 10px 14px 10px 38px; background: var(--bg2); border: 1px solid var(--glass-bd); border-radius: 24px; color: var(--tx); font: 400 14px var(--font); outline: none; }
.search-input:focus { border-color: var(--blue); }

/* NAAM-TAG */
.naam-tag {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 6px 14px; margin: 3px; border-radius: 20px;
  font-size: 12px; font-weight: 600; background: var(--accent-soft);
  color: var(--accent); border: 1px solid rgba(239,68,68,.2);
  cursor: pointer; transition: var(--tr);
}
.naam-tag:hover { background: rgba(239,68,68,.2); }
.naam-tag .count { background: var(--accent); color: #fff; border-radius: 10px; padding: 1px 7px; font-size: 10px; margin-left: 2px; }

/* AI CHAT */
.ai-bubble {
  padding: 14px 16px; border-radius: 14px 14px 14px 4px;
  background: var(--blue-soft); border: 1px solid rgba(59,130,246,.2);
  font-size: 14px; color: var(--tx); line-height: 1.6; margin-bottom: 10px;
}
.user-bubble {
  padding: 14px 16px; border-radius: 14px 14px 4px 14px;
  background: var(--surface); border: 1px solid var(--glass-bd);
  font-size: 14px; color: var(--tx); line-height: 1.6; margin-bottom: 10px;
  margin-left: 40px;
}
</style>
</head>
<body>
<div class="shell">
  <header class="top">
    <div class="top-inner">
      <div class="logo" onclick="go('/')">
        <span class="mi">gavel</span>
        Meldpunt <b>Ambtenaren</b>
      </div>
      <div class="spacer"></div>
      <button class="hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')">
        <span class="mi" style="font-size:26px">menu</span>
      </button>
      <nav class="nav-links" id="navLinks">
        <button class="nav-btn" data-r="/" onclick="go('/')"><span class="mi mi-sm">home</span> Home</button>
        <button class="nav-btn" data-r="/meldingen" onclick="go('/meldingen')"><span class="mi mi-sm">list</span> Meldingen</button>
        <button class="nav-btn" data-r="/namen" onclick="go('/namen')"><span class="mi mi-sm">people</span> Namen</button>
        <button class="nav-btn" data-r="/missie" onclick="go('/missie')"><span class="mi mi-sm">flag</span> Missie</button>
        <button class="nav-btn cta" data-r="/melden" onclick="go('/melden')"><span class="mi mi-sm">add_circle</span> Meld</button>
      </nav>
    </div>
  </header>

  <main class="main" id="app"></main>

  <footer class="footer">
    Meldpunt Ambtenaren v2.0 — Namen. Verhalen. Verantwoording.<br>
    Geen juridisch advies. Raadpleeg een jurist voor complexe zaken.
  </footer>
</div>

<div class="toast-box" id="toasts"></div>

<script>
/* ============================================================
   MELDPUNT AMBTENAREN v2.0 — Simpel. Namen. Verhalen. Publiceer.
   ============================================================ */

// ============ DATASTORE ============
var DS = {
  _k: function(c){ return 'ma_' + c; },
  all: function(c){ try { return JSON.parse(localStorage.getItem(this._k(c)) || '[]'); } catch(e){ return []; } },
  get: function(c, id){ var a = this.all(c); for(var i=0;i<a.length;i++){ if(a[i].id===id) return a[i]; } return null; },
  add: function(c, item){
    var a = this.all(c);
    if(!item.id) item.id = 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2,6);
    a.push(item);
    localStorage.setItem(this._k(c), JSON.stringify(a));
    return item;
  },
  update: function(c, id, u){
    var a = this.all(c);
    for(var i=0;i<a.length;i++){ if(a[i].id===id){ for(var k in u) a[i][k]=u[k]; localStorage.setItem(this._k(c),JSON.stringify(a)); return a[i]; } }
    return null;
  },
  count: function(c){ return this.all(c).length; },
  query: function(c, fn){ return this.all(c).filter(fn); }
};

// ============ ROUTER ============
var _route = '/';
var _params = {};

function go(path){ window.location.hash = '#' + path; }

function parseRoute(){
  var h = window.location.hash.replace(/^#/,'') || '/';
  _params = {};
  if(h === '/' || h === '') _route = '/';
  else if(h === '/meldingen') _route = '/meldingen';
  else if(h.indexOf('/melding/') === 0){ _route = '/melding'; _params.id = h.replace('/melding/',''); }
  else if(h === '/melden') _route = '/melden';
  else if(h === '/melden-ai') _route = '/melden-ai';
  else if(h === '/namen') _route = '/namen';
  else if(h === '/missie') _route = '/missie';
  else if(h === '/klokkenluider') _route = '/klokkenluider';
  else _route = '/';
  render();
  updateNav();
  window.scrollTo(0,0);
  var nl = document.getElementById('navLinks'); if(nl) nl.classList.remove('open');
}

function updateNav(){
  document.querySelectorAll('.nav-btn[data-r]').forEach(function(el){
    el.classList.toggle('active', el.getAttribute('data-r') === _route && !el.classList.contains('cta'));
  });
}

function render(){
  var app = document.getElementById('app');
  switch(_route){
    case '/': app.innerHTML = pgHome(); break;
    case '/meldingen': app.innerHTML = pgMeldingen(); break;
    case '/melding': app.innerHTML = pgMelding(); break;
    case '/melden': app.innerHTML = pgMelden(); break;
    case '/melden-ai': app.innerHTML = pgMeldenAI(); initAI(); break;
    case '/namen': app.innerHTML = pgNamen(); break;
    case '/missie': app.innerHTML = pgMissie(); break;
    case '/klokkenluider': app.innerHTML = pgKlokkenluider(); break;
    default: app.innerHTML = pgHome();
  }
}

window.addEventListener('hashchange', parseRoute);

// ============ HELPERS ============
function toast(msg){
  var el = document.createElement('div'); el.className = 'toast'; el.textContent = msg;
  document.getElementById('toasts').appendChild(el);
  setTimeout(function(){ el.classList.add('out'); setTimeout(function(){ el.remove(); },300); },3000);
}
function esc(s){ return s ? String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') : ''; }
function trunc(s,n){ return s && s.length > n ? s.substring(0,n) + '...' : (s||''); }
function fmtDate(ts){ return ts ? new Date(ts).toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'}) : '-'; }
function timeAgo(ts){
  if(!ts) return '';
  var d = Math.floor((Date.now()-ts)/86400000);
  if(d === 0) return 'vandaag';
  if(d === 1) return 'gisteren';
  if(d < 7) return d + ' dagen geleden';
  if(d < 30) return Math.floor(d/7) + ' weken geleden';
  return Math.floor(d/30) + ' maanden geleden';
}

// ============ PAGE: HOME ============
function pgHome(){
  var meldingen = DS.all('meldingen');
  var namen = getNamenLijst(meldingen);
  var recent = meldingen.slice().sort(function(a,b){ return (b.ts||0)-(a.ts||0); }).slice(0,4);

  // Naam-tags (top 12)
  var namenHtml = '';
  namen.slice(0,12).forEach(function(n){
    namenHtml += '<span class="naam-tag" onclick="go(\'/namen\')">' + esc(n.naam) + '<span class="count">' + n.count + '</span></span>';
  });

  var recentHtml = '';
  if(recent.length === 0){
    recentHtml = '<div class="empty"><span class="mi">inbox</span><p>Nog geen meldingen. Jij kunt de eerste zijn.</p></div>';
  } else {
    recentHtml = '<div class="card-grid">';
    recent.forEach(function(m){ recentHtml += meldingCard(m); });
    recentHtml += '</div>';
  }

  return '<div class="page">' +
    // HERO
    '<div style="text-align:center;padding:40px 0 28px">' +
      '<h1 style="font-size:clamp(26px,5vw,40px);font-weight:800;line-height:1.15;margin-bottom:14px">Wil jij je recht halen?</h1>' +
      '<p style="font-size:17px;color:var(--accent);font-weight:700;margin-bottom:10px">Wij helpen je om de daders verantwoordelijk te houden.</p>' +
      '<p style="font-size:15px;color:var(--tx2);max-width:560px;margin:0 auto 20px">Dit platform verzamelt namen en verhalen van ambtenaren die burgers benadelen. Anoniem of openbaar. Voor burgers en klokkenluiders.</p>' +
      '<div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">' +
        '<button class="btn btn-red btn-lg" onclick="go(\'/melden\')"><span class="mi">add_circle</span> Doe een melding</button>' +
        '<button class="btn btn-blue btn-lg" onclick="go(\'/melden-ai\')"><span class="mi">smart_toy</span> AI helpt je melden</button>' +
        '<button class="btn btn-ghost btn-lg" onclick="go(\'/klokkenluider\')"><span class="mi">shield</span> Klokkenluider</button>' +
      '</div>' +
    '</div>' +

    // STATS
    '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px">' +
      '<div class="card" style="text-align:center;padding:16px"><div style="font-size:28px;font-weight:800">' + meldingen.length + '</div><div style="font-size:11px;color:var(--tx3);text-transform:uppercase">Meldingen</div></div>' +
      '<div class="card" style="text-align:center;padding:16px"><div style="font-size:28px;font-weight:800;color:var(--accent)">' + namen.length + '</div><div style="font-size:11px;color:var(--tx3);text-transform:uppercase">Namen</div></div>' +
      '<div class="card" style="text-align:center;padding:16px"><div style="font-size:28px;font-weight:800;color:var(--yellow)">' + namen.filter(function(n){return n.count>=2;}).length + '</div><div style="font-size:11px;color:var(--tx3);text-transform:uppercase">Herhalers</div></div>' +
    '</div>' +

    // NAMEN TICKER
    (namenHtml ? '<div class="card" style="margin-bottom:20px;padding:16px">' +
      '<div style="font-size:13px;font-weight:700;margin-bottom:8px"><span class="mi mi-sm" style="color:var(--accent)">people</span> Meest genoemde namen</div>' +
      '<div style="display:flex;flex-wrap:wrap;gap:0">' + namenHtml + '</div>' +
      '<div style="text-align:right;margin-top:8px"><a href="#/namen" style="font-size:12px">Bekijk alle namen &rarr;</a></div>' +
    '</div>' : '') +

    // HOE WERKT HET
    '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:24px">' +
      '<div class="card" style="text-align:center;padding:20px">' +
        '<span class="mi" style="font-size:32px;color:var(--accent);display:block;margin-bottom:8px">edit_note</span>' +
        '<div style="font-size:14px;font-weight:700;margin-bottom:4px">1. Meld</div>' +
        '<div style="font-size:12px;color:var(--tx2)">Voer naam(en), instantie en je verhaal in. Anoniem mag.</div>' +
      '</div>' +
      '<div class="card" style="text-align:center;padding:20px">' +
        '<span class="mi" style="font-size:32px;color:var(--accent);display:block;margin-bottom:8px">visibility</span>' +
        '<div style="font-size:14px;font-weight:700;margin-bottom:4px">2. Publiceer</div>' +
        '<div style="font-size:12px;color:var(--tx2)">Je melding wordt gepubliceerd. Namen worden geregistreerd.</div>' +
      '</div>' +
      '<div class="card" style="text-align:center;padding:20px">' +
        '<span class="mi" style="font-size:32px;color:var(--accent);display:block;margin-bottom:8px">trending_up</span>' +
        '<div style="font-size:14px;font-weight:700;margin-bottom:4px">3. Patronen</div>' +
        '<div style="font-size:12px;color:var(--tx2)">Dezelfde naam meerdere keren? Structureel wangedrag wordt zichtbaar.</div>' +
      '</div>' +
      '<div class="card" style="text-align:center;padding:20px">' +
        '<span class="mi" style="font-size:32px;color:var(--accent);display:block;margin-bottom:8px">gavel</span>' +
        '<div style="font-size:14px;font-weight:700;margin-bottom:4px">4. Verantwoording</div>' +
        '<div style="font-size:12px;color:var(--tx2)">Met genoeg namen en verhalen houden we mensen verantwoordelijk. <strong style="color:var(--accent)">1 naam is al genoeg.</strong></div>' +
      '</div>' +
    '</div>' +

    // RECENTE MELDINGEN
    '<h2 style="font-size:18px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px"><span class="mi">schedule</span> Recente meldingen</h2>' +
    recentHtml +

    // CTA
    '<div style="text-align:center;padding:24px 0 0">' +
      '<button class="btn btn-red" onclick="go(\'/missie\')"><span class="mi mi-sm">flag</span> Lees onze missie</button>' +
    '</div>' +
  '</div>';
}

// ============ MELDING CARD ============
function meldingCard(m){
  var namenStr = (m.namen || []).map(function(n){ return esc(n.naam); }).join(', ') || 'Geen naam genoemd';
  return '<div class="card m-card" onclick="go(\'/melding/' + m.id + '\')">' +
    '<div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;margin-bottom:6px">' +
      '<h3 style="font-size:14px;font-weight:700;line-height:1.3">' + esc(m.titel) + '</h3>' +
      (m.klokkenluider ? '<span class="badge badge-purple"><span class="mi mi-sm">shield</span> Klokkenluider</span>' : '') +
    '</div>' +
    '<div style="font-size:12px;color:var(--accent);margin-bottom:4px;font-weight:600"><span class="mi mi-sm">person</span> ' + namenStr + '</div>' +
    (m.instantie ? '<div style="font-size:11px;color:var(--tx3);margin-bottom:6px"><span class="mi mi-sm">business</span> ' + esc(m.instantie) + '</div>' : '') +
    '<div style="font-size:13px;color:var(--tx2);line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden">' + esc(trunc(m.verhaal,200)) + '</div>' +
    '<div style="display:flex;justify-content:space-between;font-size:11px;color:var(--tx3);margin-top:10px;padding-top:8px;border-top:1px solid var(--glass-bd)">' +
      '<span>' + timeAgo(m.ts) + '</span>' +
      '<span>' + (m.anoniem ? '<span class="mi mi-sm">visibility_off</span> Anoniem' : esc(m.melder_naam || 'Burger')) + '</span>' +
    '</div>' +
  '</div>';
}

// ============ NAMEN AGGREGATIE ============
function getNamenLijst(meldingen){
  if(!meldingen) meldingen = DS.all('meldingen');
  var map = {};
  meldingen.forEach(function(m){
    (m.namen || []).forEach(function(n){
      var key = (n.naam||'').trim().toLowerCase();
      if(!key) return;
      if(!map[key]) map[key] = { naam: n.naam, count: 0, instanties: {}, meldingIds: [] };
      map[key].count++;
      if(n.functie) map[key].functie = n.functie;
      if(m.instantie) map[key].instanties[m.instantie] = true;
      map[key].meldingIds.push(m.id);
      if(n.naam.length > map[key].naam.length) map[key].naam = n.naam;
    });
  });
  var list = [];
  for(var k in map) list.push(map[k]);
  list.sort(function(a,b){ return b.count - a.count; });
  return list;
}

// ============ PAGE: MELDINGEN OVERZICHT ============
var _zoek = '';

function pgMeldingen(){
  var meldingen = DS.all('meldingen').sort(function(a,b){ return (b.ts||0)-(a.ts||0); });
  if(_zoek){
    var z = _zoek.toLowerCase();
    meldingen = meldingen.filter(function(m){
      var tekst = (m.titel||'') + ' ' + (m.verhaal||'') + ' ' + (m.instantie||'') + ' ' + (m.namen||[]).map(function(n){return n.naam;}).join(' ');
      return tekst.toLowerCase().indexOf(z) >= 0;
    });
  }

  var listHtml = '';
  if(meldingen.length === 0){
    listHtml = '<div class="empty"><span class="mi">search_off</span><p>Geen meldingen gevonden.</p></div>';
  } else {
    listHtml = '<div class="card-grid">';
    meldingen.forEach(function(m){ listHtml += meldingCard(m); });
    listHtml += '</div>';
  }

  return '<div class="page">' +
    '<h2 style="font-size:20px;font-weight:700;margin-bottom:14px"><span class="mi">list</span> Alle meldingen <span style="font-size:14px;color:var(--tx3);font-weight:400">(' + meldingen.length + ')</span></h2>' +
    '<div class="search-wrap"><span class="mi">search</span><input class="search-input" placeholder="Zoek op naam, instantie, verhaal..." value="' + esc(_zoek) + '" oninput="zoekMeldingen(this.value)"></div>' +
    listHtml +
  '</div>';
}

function zoekMeldingen(val){
  _zoek = val;
  clearTimeout(window._zt);
  window._zt = setTimeout(function(){
    document.getElementById('app').innerHTML = pgMeldingen();
    var inp = document.querySelector('.search-input');
    if(inp){ inp.focus(); inp.setSelectionRange(inp.value.length, inp.value.length); }
  }, 250);
}

// ============ PAGE: MELDING DETAIL ============
function pgMelding(){
  var m = DS.get('meldingen', _params.id);
  if(!m) return '<div class="page"><div class="empty"><span class="mi">error</span><p>Melding niet gevonden.</p></div></div>';

  DS.update('meldingen', m.id, { views: (m.views||0)+1 });

  var namenHtml = '';
  (m.namen || []).forEach(function(n){
    namenHtml += '<div style="display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--accent-soft);border-radius:var(--rs);margin-bottom:6px;border-left:3px solid var(--accent)">' +
      '<span class="mi" style="color:var(--accent)">person</span>' +
      '<div>' +
        '<div style="font-size:14px;font-weight:700">' + esc(n.naam) + '</div>' +
        (n.functie ? '<div style="font-size:12px;color:var(--tx2)">' + esc(n.functie) + '</div>' : '') +
      '</div>' +
    '</div>';
  });

  var verhaalHtml = (m.verhaal||'').split('\n').filter(function(p){return p.trim();}).map(function(p){return '<p style="margin-bottom:10px">' + esc(p) + '</p>';}).join('');

  // Reacties
  var reacties = DS.query('reacties', function(r){ return r.mid === m.id; }).sort(function(a,b){ return (a.ts||0)-(b.ts||0); });
  var reactieHtml = '';
  reacties.forEach(function(r){
    reactieHtml += '<div class="card" style="padding:12px;margin-bottom:6px">' +
      '<div style="display:flex;justify-content:space-between;font-size:11px;color:var(--tx3);margin-bottom:4px">' +
        '<span>' + esc(r.naam||'Anoniem') + '</span><span>' + timeAgo(r.ts) + '</span>' +
      '</div>' +
      '<div style="font-size:13px">' + esc(r.tekst) + '</div>' +
    '</div>';
  });

  return '<div class="page">' +
    '<button class="btn btn-ghost btn-sm" onclick="go(\'/meldingen\')" style="margin-bottom:14px"><span class="mi mi-sm">arrow_back</span> Terug</button>' +

    '<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px">' +
      (m.klokkenluider ? '<span class="badge badge-purple"><span class="mi mi-sm">shield</span> Klokkenluider</span>' : '') +
      (m.instantie ? '<span class="badge badge-blue"><span class="mi mi-sm">business</span> ' + esc(m.instantie) + '</span>' : '') +
      '<span class="badge badge-blue"><span class="mi mi-sm">event</span> ' + fmtDate(m.ts) + '</span>' +
    '</div>' +

    '<h1 style="font-size:22px;font-weight:800;margin-bottom:14px;line-height:1.3">' + esc(m.titel) + '</h1>' +

    // Namen
    (namenHtml ? '<div style="margin-bottom:16px"><div style="font-size:12px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">Genoemde namen</div>' + namenHtml + '</div>' : '') +

    // Verhaal
    '<div style="font-size:15px;line-height:1.8;margin-bottom:20px">' + verhaalHtml + '</div>' +

    // Deel
    '<div class="card" style="padding:14px;margin-bottom:16px;border-left:3px solid var(--green)">' +
      '<div style="font-size:12px;font-weight:700;margin-bottom:6px"><span class="mi mi-sm" style="color:var(--green)">share</span> Deel dit verhaal</div>' +
      '<div style="display:flex;gap:6px;flex-wrap:wrap">' +
        '<button class="btn btn-sm btn-ghost" onclick="deel(\'' + m.id + '\',\'x\')">X / Twitter</button>' +
        '<button class="btn btn-sm btn-ghost" onclick="deel(\'' + m.id + '\',\'wa\')">WhatsApp</button>' +
        '<button class="btn btn-sm btn-ghost" onclick="deel(\'' + m.id + '\',\'fb\')">Facebook</button>' +
        '<button class="btn btn-sm btn-ghost" onclick="deel(\'' + m.id + '\',\'copy\')"><span class="mi mi-sm">content_copy</span> Link</button>' +
      '</div>' +
    '</div>' +

    // Reacties
    '<h3 style="font-size:15px;font-weight:700;margin-bottom:10px"><span class="mi mi-sm">chat</span> Reacties (' + reacties.length + ')</h3>' +
    reactieHtml +
    '<div class="card" style="padding:12px;margin-top:6px">' +
      '<textarea class="ft" id="rTekst" style="min-height:50px;margin-bottom:6px" placeholder="Schrijf een reactie..."></textarea>' +
      '<div style="display:flex;gap:8px;align-items:center">' +
        '<input class="fi" id="rNaam" placeholder="Je naam (optioneel)" style="flex:1;padding:8px 12px">' +
        '<button class="btn btn-red btn-sm" onclick="plaatsReactie(\'' + m.id + '\')"><span class="mi mi-sm">send</span></button>' +
      '</div>' +
    '</div>' +
  '</div>';
}

function plaatsReactie(mid){
  var t = (document.getElementById('rTekst')||{}).value;
  if(!t || !t.trim()){ toast('Schrijf eerst iets'); return; }
  DS.add('reacties', { mid: mid, naam: ((document.getElementById('rNaam')||{}).value||'').trim() || 'Anoniem', tekst: t.trim(), ts: Date.now() });
  toast('Reactie geplaatst!');
  render();
}

function deel(id, platform){
  var m = DS.get('meldingen', id); if(!m) return;
  var url = location.origin + location.pathname + '#/melding/' + id;
  var txt = 'Lees dit op Meldpunt Ambtenaren: "' + (m.titel||'') + '"';
  if(platform==='x') window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(txt)+'&url='+encodeURIComponent(url),'_blank');
  else if(platform==='wa') window.open('https://wa.me/?text='+encodeURIComponent(txt+' '+url),'_blank');
  else if(platform==='fb') window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(url),'_blank');
  else if(platform==='copy'){ if(navigator.clipboard) navigator.clipboard.writeText(url).then(function(){toast('Link gekopieerd!')}); else prompt('Kopieer:',url); }
}

// ============ PAGE: MELDEN (SIMPEL FORMULIER) ============
var _namen = [{ naam: '', functie: '' }];

function pgMelden(){
  var namenHtml = '';
  _namen.forEach(function(n, i){
    namenHtml += '<div style="display:flex;gap:8px;margin-bottom:8px;align-items:flex-start">' +
      '<div style="flex:2"><input class="fi" id="nNaam' + i + '" value="' + esc(n.naam) + '" placeholder="Naam ambtenaar" oninput="updateNaam(' + i + ',\'naam\',this.value)"></div>' +
      '<div style="flex:1"><input class="fi" id="nFunc' + i + '" value="' + esc(n.functie) + '" placeholder="Functie (optioneel)" oninput="updateNaam(' + i + ',\'functie\',this.value)"></div>' +
      (i > 0 ? '<button class="btn btn-sm btn-ghost" onclick="verwijderNaam(' + i + ')" style="padding:8px"><span class="mi mi-sm">close</span></button>' : '<div style="width:42px"></div>') +
    '</div>';
  });

  return '<div class="page">' +
    '<h2 style="font-size:20px;font-weight:700;margin-bottom:4px"><span class="mi">edit_note</span> Doe een melding</h2>' +
    '<p style="font-size:13px;color:var(--tx2);margin-bottom:18px">Voer de namen in, de instantie, en vertel wat er is gebeurd. Zo simpel is het.</p>' +

    '<div class="card" style="padding:24px">' +

      // Namen
      '<div style="font-size:13px;font-weight:700;margin-bottom:8px;color:var(--accent)"><span class="mi mi-sm">person</span> Naam / namen</div>' +
      namenHtml +
      '<button class="btn btn-sm btn-ghost" onclick="voegNaamToe()" style="margin-bottom:18px"><span class="mi mi-sm">add</span> Nog een naam</button>' +

      // Instantie
      '<div class="fg">' +
        '<label class="fl">Instantie / organisatie</label>' +
        '<input class="fi" id="mInstantie" placeholder="Bijv. Gemeente Rotterdam, Belastingdienst, UWV, Jeugdzorg..." value="">' +
      '</div>' +

      // Titel
      '<div class="fg">' +
        '<label class="fl">Titel</label>' +
        '<input class="fi" id="mTitel" placeholder="Korte omschrijving, bijv. \'Al 2 jaar wachten op besluit\'">' +
      '</div>' +

      // Verhaal
      '<div class="fg">' +
        '<label class="fl">Wat is er gebeurd?</label>' +
        '<textarea class="ft" id="mVerhaal" style="min-height:180px" placeholder="Vertel je verhaal. Noem data, feiten, wat er precies is gezegd of gedaan. Hoe meer detail, hoe beter.\n\nJe mag ook alleen namen noemen zonder lang verhaal — elke melding telt."></textarea>' +
      '</div>' +

      // Anoniem
      '<div style="margin-bottom:16px">' +
        '<label class="fcheck"><input type="checkbox" id="mAnoniem" checked> Ik wil anoniem melden</label>' +
        '<div class="fhint">Als je anoniem meldt worden je gegevens niet opgeslagen.</div>' +
      '</div>' +

      // Melder gegevens (optioneel)
      '<div id="melderVelden" style="display:none">' +
        '<div class="fg"><label class="fl">Je naam</label><input class="fi" id="mNaam" placeholder="Optioneel"></div>' +
        '<div class="fg"><label class="fl">E-mail</label><input class="fi" id="mEmail" type="email" placeholder="Optioneel — voor opvolging"></div>' +
      '</div>' +

      // Submit
      '<div style="display:flex;gap:10px;justify-content:space-between;align-items:center;flex-wrap:wrap">' +
        '<button class="btn btn-blue" onclick="go(\'/melden-ai\')"><span class="mi mi-sm">smart_toy</span> Liever met AI-hulp?</button>' +
        '<button class="btn btn-red btn-lg" onclick="submitMelding()"><span class="mi">send</span> Publiceer melding</button>' +
      '</div>' +

    '</div>' +

    // Privacy notice
    '<div style="text-align:center;padding:16px 0;font-size:11px;color:var(--tx3)">' +
      '<span class="mi mi-sm" style="color:var(--green)">lock</span> Alles wordt lokaal in je browser opgeslagen. Geen servers, geen tracking.' +
    '</div>' +
  '</div>';
}

function voegNaamToe(){ _namen.push({naam:'',functie:''}); render(); }
function verwijderNaam(i){ _namen.splice(i,1); render(); }
function updateNaam(i,field,val){ _namen[i][field] = val; }

function submitMelding(){
  // Sync namen van velden
  _namen.forEach(function(n,i){
    var nEl = document.getElementById('nNaam'+i);
    var fEl = document.getElementById('nFunc'+i);
    if(nEl) n.naam = nEl.value.trim();
    if(fEl) n.functie = fEl.value.trim();
  });

  var titel = (document.getElementById('mTitel')||{}).value || '';
  var verhaal = (document.getElementById('mVerhaal')||{}).value || '';
  var instantie = (document.getElementById('mInstantie')||{}).value || '';
  var anoniem = (document.getElementById('mAnoniem')||{}).checked;

  // Filter lege namen
  var namen = _namen.filter(function(n){ return n.naam.trim(); });

  if(!titel.trim()){ toast('Vul een titel in'); return; }
  if(!verhaal.trim() && namen.length === 0){ toast('Vul een verhaal in of noem een naam'); return; }

  var melding = {
    titel: titel.trim(),
    verhaal: verhaal.trim(),
    instantie: instantie.trim(),
    namen: namen,
    anoniem: anoniem,
    melder_naam: anoniem ? null : ((document.getElementById('mNaam')||{}).value || '').trim() || null,
    melder_email: anoniem ? null : ((document.getElementById('mEmail')||{}).value || '').trim() || null,
    klokkenluider: false,
    ts: Date.now(),
    views: 0
  };

  var saved = DS.add('meldingen', melding);
  toast('Melding gepubliceerd!');
  _namen = [{naam:'',functie:''}];
  go('/melding/' + saved.id);
}

// Toggle anoniem
document.addEventListener('change', function(e){
  if(e.target && e.target.id === 'mAnoniem'){
    var v = document.getElementById('melderVelden');
    if(v) v.style.display = e.target.checked ? 'none' : 'block';
  }
});

// ============ PAGE: AI-HULP BIJ MELDEN ============
var _aiChat = [];
var _aiStep = 0;
var _aiData = {};

var AI_VRAGEN = [
  { key: 'namen', vraag: 'Over wie gaat het? Noem de naam (of namen) van de ambtenaar of ambtenaren. Als je de naam niet weet, noem dan de functie of afdeling.', placeholder: 'Bijv. Dhr. Janssen, baliemedewerker' },
  { key: 'instantie', vraag: 'Bij welke instantie of organisatie werkt deze persoon? Denk aan een gemeente, ministerie, UWV, Belastingdienst, etc.', placeholder: 'Bijv. Gemeente Amsterdam' },
  { key: 'wat', vraag: 'Wat is er precies gebeurd? Beschrijf de situatie. Noem data als je die weet, en wat er precies is gezegd of gedaan.', placeholder: 'Vertel je verhaal...' },
  { key: 'gevolgen', vraag: 'Wat zijn de gevolgen voor jou of anderen? Financieel, emotioneel, praktisch — alles telt.', placeholder: 'Bijv. Ik heb 6 maanden geen inkomen gehad...' },
  { key: 'titel', vraag: 'Hoe zou je dit in een zin samenvatten? Dit wordt de titel van je melding.', placeholder: 'Bijv. Al 8 maanden wachten op WOZ-bezwaar' }
];

function pgMeldenAI(){
  var chatHtml = '';
  _aiChat.forEach(function(msg){
    if(msg.role === 'ai'){
      chatHtml += '<div class="ai-bubble"><span class="mi mi-sm" style="color:var(--blue)">smart_toy</span> ' + esc(msg.text) + '</div>';
    } else {
      chatHtml += '<div class="user-bubble">' + esc(msg.text) + '</div>';
    }
  });

  var inputArea = '';
  if(_aiStep < AI_VRAGEN.length){
    var v = AI_VRAGEN[_aiStep];
    inputArea = '<div style="margin-top:10px">' +
      (v.key === 'wat' || v.key === 'gevolgen' ?
        '<textarea class="ft" id="aiInput" style="min-height:100px" placeholder="' + esc(v.placeholder) + '"></textarea>' :
        '<input class="fi" id="aiInput" placeholder="' + esc(v.placeholder) + '">') +
      '<div style="display:flex;gap:8px;margin-top:8px">' +
        '<button class="btn btn-blue" onclick="aiAntwoord()"><span class="mi mi-sm">send</span> Verstuur</button>' +
        '<button class="btn btn-ghost btn-sm" onclick="aiSkip()">Overslaan</button>' +
      '</div>' +
    '</div>';
  } else {
    inputArea = '<div style="margin-top:14px;text-align:center">' +
      '<div class="card" style="padding:16px;margin-bottom:12px;border-left:3px solid var(--green)">' +
        '<div style="font-size:14px;font-weight:700;color:var(--green);margin-bottom:4px"><span class="mi mi-sm">check_circle</span> Klaar!</div>' +
        '<div style="font-size:13px;color:var(--tx2)">Ik heb alle info. Klik hieronder om je melding te publiceren.</div>' +
      '</div>' +
      '<div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center">' +
        '<label class="fcheck" style="margin-bottom:8px"><input type="checkbox" id="aiAnoniem" checked> Anoniem melden</label>' +
      '</div>' +
      '<button class="btn btn-red btn-lg" onclick="aiSubmit()"><span class="mi">send</span> Publiceer melding</button>' +
    '</div>';
  }

  return '<div class="page">' +
    '<h2 style="font-size:20px;font-weight:700;margin-bottom:4px"><span class="mi">smart_toy</span> AI helpt je melden</h2>' +
    '<p style="font-size:13px;color:var(--tx2);margin-bottom:16px">Ik stel je een paar vragen en maak er een melding van. Geen stress, gewoon antwoorden.</p>' +
    '<div class="card" style="padding:20px">' +
      '<div id="aiChatBox">' + chatHtml + '</div>' +
      inputArea +
    '</div>' +
    '<div style="text-align:center;padding:12px 0"><button class="btn btn-ghost btn-sm" onclick="go(\'/melden\')">Liever zelf invullen?</button></div>' +
  '</div>';
}

function initAI(){
  if(_aiChat.length === 0 && _aiStep === 0){
    _aiChat.push({ role: 'ai', text: 'Hoi! Ik help je een melding doen. Ik stel je een paar korte vragen. Je kunt altijd overslaan als je iets niet weet.' });
    _aiChat.push({ role: 'ai', text: AI_VRAGEN[0].vraag });
    render();
  }
  // Focus input
  setTimeout(function(){ var inp = document.getElementById('aiInput'); if(inp) inp.focus(); }, 100);
}

function aiAntwoord(){
  var inp = document.getElementById('aiInput');
  if(!inp) return;
  var val = inp.value.trim();
  if(!val){ toast('Typ iets of klik overslaan'); return; }

  var v = AI_VRAGEN[_aiStep];
  _aiData[v.key] = val;
  _aiChat.push({ role: 'user', text: val });
  _aiStep++;

  if(_aiStep < AI_VRAGEN.length){
    _aiChat.push({ role: 'ai', text: AI_VRAGEN[_aiStep].vraag });
  } else {
    _aiChat.push({ role: 'ai', text: 'Top, ik heb alles. Wil je de melding anoniem doen? Dan kun je hem nu publiceren.' });
  }
  render();
  setTimeout(function(){ var inp2 = document.getElementById('aiInput'); if(inp2) inp2.focus(); }, 100);
}

function aiSkip(){
  var v = AI_VRAGEN[_aiStep];
  _aiChat.push({ role: 'user', text: '(overgeslagen)' });
  _aiStep++;

  if(_aiStep < AI_VRAGEN.length){
    _aiChat.push({ role: 'ai', text: AI_VRAGEN[_aiStep].vraag });
  } else {
    _aiChat.push({ role: 'ai', text: 'Goed, ik heb genoeg info. Je kunt je melding nu publiceren.' });
  }
  render();
}

function aiSubmit(){
  var titel = _aiData.titel || (_aiData.wat ? _aiData.wat.substring(0,60) : 'Melding');
  var verhaal = '';
  if(_aiData.wat) verhaal += _aiData.wat;
  if(_aiData.gevolgen) verhaal += '\n\nGevolgen: ' + _aiData.gevolgen;

  // Parse namen
  var namen = [];
  if(_aiData.namen){
    _aiData.namen.split(',').forEach(function(n){
      var parts = n.trim().split(/\s*[-–]\s*/);
      namen.push({ naam: (parts[0]||'').trim(), functie: (parts[1]||'').trim() });
    });
  }

  var anoniem = (document.getElementById('aiAnoniem')||{}).checked !== false;

  var melding = {
    titel: titel.trim(),
    verhaal: verhaal.trim(),
    instantie: (_aiData.instantie || '').trim(),
    namen: namen.filter(function(n){ return n.naam; }),
    anoniem: anoniem,
    melder_naam: null,
    melder_email: null,
    klokkenluider: false,
    ts: Date.now(),
    views: 0
  };

  var saved = DS.add('meldingen', melding);
  toast('Melding gepubliceerd!');
  _aiChat = []; _aiStep = 0; _aiData = {};
  go('/melding/' + saved.id);
}

// ============ PAGE: NAMEN OVERZICHT ============
function pgNamen(){
  var namen = getNamenLijst();

  var listHtml = '';
  if(namen.length === 0){
    listHtml = '<div class="empty"><span class="mi">people</span><p>Nog geen namen. Doe een melding om het overzicht te vullen.</p></div>';
  } else {
    listHtml = '<div class="card-grid">';
    namen.forEach(function(n){
      var kleur = n.count >= 3 ? 'var(--accent)' : (n.count >= 2 ? 'var(--yellow)' : 'var(--tx3)');
      var orgs = Object.keys(n.instanties).join(', ') || '';
      listHtml += '<div class="card" style="border-left:3px solid ' + kleur + '">' +
        '<div style="display:flex;justify-content:space-between;align-items:flex-start">' +
          '<div>' +
            '<div style="font-size:15px;font-weight:800">' + esc(n.naam) + '</div>' +
            (n.functie ? '<div style="font-size:12px;color:var(--tx2)">' + esc(n.functie) + '</div>' : '') +
            (orgs ? '<div style="font-size:12px;color:var(--tx3)">' + esc(orgs) + '</div>' : '') +
          '</div>' +
          '<div style="text-align:right">' +
            '<div style="font-size:24px;font-weight:800;color:' + kleur + '">' + n.count + '</div>' +
            '<div style="font-size:10px;color:var(--tx3)">melding' + (n.count!==1?'en':'') + '</div>' +
          '</div>' +
        '</div>' +
        '<div style="margin-top:8px;display:flex;gap:4px;flex-wrap:wrap">' +
          n.meldingIds.map(function(id){ return '<a href="#/melding/' + id + '" style="font-size:11px">Bekijk</a>'; }).join(' <span style="color:var(--tx3)">&middot;</span> ') +
        '</div>' +
      '</div>';
    });
    listHtml += '</div>';
  }

  var herhalers = namen.filter(function(n){ return n.count >= 2; });

  return '<div class="page">' +
    '<h2 style="font-size:20px;font-weight:700;margin-bottom:4px"><span class="mi">people</span> Namen</h2>' +
    '<p style="font-size:13px;color:var(--tx2);margin-bottom:16px">Alle genoemde namen, gesorteerd op aantal meldingen. Namen die meerdere keren voorkomen wijzen op structureel gedrag.</p>' +

    (herhalers.length > 0 ? '<div class="card" style="border-left:3px solid var(--accent);margin-bottom:14px;background:var(--accent-soft)">' +
      '<div style="font-size:14px;font-weight:700;color:var(--accent)"><span class="mi mi-sm">warning</span> ' + herhalers.length + ' naam/namen bij meerdere meldingen</div>' +
      '<div style="font-size:12px;color:var(--tx2)">Dit zijn geen incidenten. Dit zijn patronen.</div>' +
    '</div>' : '') +

    '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">' +
      '<div class="card" style="text-align:center;padding:14px"><div style="font-size:22px;font-weight:800">' + namen.length + '</div><div style="font-size:10px;color:var(--tx3)">UNIEKE NAMEN</div></div>' +
      '<div class="card" style="text-align:center;padding:14px"><div style="font-size:22px;font-weight:800;color:var(--accent)">' + herhalers.length + '</div><div style="font-size:10px;color:var(--tx3)">HERHALERS (2+)</div></div>' +
      '<div class="card" style="text-align:center;padding:14px"><div style="font-size:22px;font-weight:800;color:var(--yellow)">' + namen.filter(function(n){return n.count>=3;}).length + '</div><div style="font-size:10px;color:var(--tx3)">ROOD ALARM (3+)</div></div>' +
    '</div>' +

    listHtml +
  '</div>';
}

// ============ PAGE: KLOKKENLUIDER ============
function pgKlokkenluider(){
  var _klNamen = [{ naam: '', functie: '' }];

  return '<div class="page">' +
    '<div style="text-align:center;padding:24px 0 16px">' +
      '<span class="mi" style="font-size:44px;color:var(--purple);display:block;margin-bottom:8px">shield</span>' +
      '<h1 style="font-size:22px;font-weight:800;margin-bottom:8px">Klokkenluider</h1>' +
      '<p style="font-size:14px;color:var(--tx2);max-width:500px;margin:0 auto">Je ziet dingen op je werk die niet kloppen. Collega\'s die burgers benadelen, dossiers die verdwijnen, instructies om de andere kant op te kijken. Dit is een veilige plek om te melden.</p>' +
    '</div>' +

    '<div class="card" style="padding:20px;margin-bottom:16px;background:var(--green-soft);border:1px solid rgba(34,197,94,.2)">' +
      '<div style="font-size:14px;font-weight:700;color:var(--green);margin-bottom:8px"><span class="mi mi-sm">verified_user</span> Veiligheidsgaranties</div>' +
      '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px;font-size:12px;color:var(--tx2)">' +
        '<div><span class="mi mi-sm" style="color:var(--green)">check</span> Volledig anoniem</div>' +
        '<div><span class="mi mi-sm" style="color:var(--green)">check</span> Data blijft in je browser</div>' +
        '<div><span class="mi mi-sm" style="color:var(--green)">check</span> Geen IP-logging</div>' +
        '<div><span class="mi mi-sm" style="color:var(--green)">check</span> Geen tracking</div>' +
      '</div>' +
    '</div>' +

    '<div class="card" style="padding:24px">' +
      '<div style="font-size:13px;font-weight:700;margin-bottom:8px;color:var(--purple)"><span class="mi mi-sm">person</span> Wie meld je? (collega\'s, leidinggevenden)</div>' +
      '<div id="klNamen">' +
        '<div style="display:flex;gap:8px;margin-bottom:8px">' +
          '<input class="fi" id="klNaam0" placeholder="Naam (mag ook initialen/functie)">' +
          '<input class="fi" id="klFunc0" placeholder="Functie" style="flex:.7">' +
        '</div>' +
      '</div>' +
      '<button class="btn btn-sm btn-ghost" onclick="klVoegNaamToe()" style="margin-bottom:16px"><span class="mi mi-sm">add</span> Nog een naam</button>' +

      '<div class="fg"><label class="fl">Organisatie</label><input class="fi" id="klInst" placeholder="Waar werk je?"></div>' +
      '<div class="fg"><label class="fl">Wat heb je gezien?</label><textarea class="ft" id="klVerhaal" style="min-height:160px" placeholder="Beschrijf wat er gebeurt. Noem feiten, geen geruchten. Hoe specifieker, hoe beter.\n\nJe hoeft geen lang verhaal te schrijven — een paar zinnen is ook goed."></textarea></div>' +
      '<div class="fg"><label class="fl">Titel</label><input class="fi" id="klTitel" placeholder="Korte omschrijving"></div>' +

      '<button class="btn btn-purple btn-lg" onclick="submitKlokkenluider()" style="width:100%"><span class="mi">shield</span> Anoniem publiceren</button>' +
    '</div>' +
  '</div>';
}

var _klNaamCount = 1;
function klVoegNaamToe(){
  var c = document.getElementById('klNamen');
  if(!c) return;
  var i = _klNaamCount++;
  var div = document.createElement('div');
  div.style = 'display:flex;gap:8px;margin-bottom:8px';
  div.innerHTML = '<input class="fi" id="klNaam' + i + '" placeholder="Naam"><input class="fi" id="klFunc' + i + '" placeholder="Functie" style="flex:.7">';
  c.appendChild(div);
}

function submitKlokkenluider(){
  var namen = [];
  for(var i = 0; i < 20; i++){
    var nEl = document.getElementById('klNaam'+i);
    var fEl = document.getElementById('klFunc'+i);
    if(nEl && nEl.value.trim()) namen.push({ naam: nEl.value.trim(), functie: (fEl?fEl.value.trim():'') });
  }
  var titel = (document.getElementById('klTitel')||{}).value || '';
  var verhaal = (document.getElementById('klVerhaal')||{}).value || '';
  var instantie = (document.getElementById('klInst')||{}).value || '';

  if(!verhaal.trim() && namen.length === 0){ toast('Vul iets in'); return; }
  if(!titel.trim()) titel = 'Klokkenluider-melding' + (instantie ? ' over ' + instantie : '');

  var melding = {
    titel: titel.trim(),
    verhaal: verhaal.trim(),
    instantie: instantie.trim(),
    namen: namen,
    anoniem: true,
    melder_naam: null,
    melder_email: null,
    klokkenluider: true,
    ts: Date.now(),
    views: 0
  };

  var saved = DS.add('meldingen', melding);
  toast('Klokkenluider-melding gepubliceerd!');
  _klNaamCount = 1;
  go('/melding/' + saved.id);
}

// ============ PAGE: MISSIE ============
function pgMissie(){
  return '<div class="page">' +
    '<div style="text-align:center;padding:28px 0 20px">' +
      '<span class="mi" style="font-size:48px;color:var(--accent);display:block;margin-bottom:8px">local_fire_department</span>' +
      '<h1 style="font-size:clamp(22px,4vw,32px);font-weight:800;line-height:1.2">Verantwoording leggen<br>waar het <span style="color:var(--accent)">hoort</span></h1>' +
      '<p style="font-size:14px;color:var(--tx2);max-width:600px;margin:10px auto 0">Niet bij de burger die klaagt. Niet bij de minister die sorry zegt. Maar bij de ambtenaar die het doet.</p>' +
    '</div>' +

    // HET PROBLEEM
    '<div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid var(--accent)">' +
      '<h2 style="font-size:17px;margin-bottom:10px">Het probleem</h2>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'De toeslagenaffaire. Groningen. Jeugdzorg. UWV. Het zijn geen incidenten — het is een <strong>systeem zonder consequenties</strong>. Ambtenaren verwoesten levens, en als het uitkomt? Worden ze overgeplaatst. Niet ontslagen. Niet vervolgd. Overgeplaatst.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:0">' +
        'Klachtcommissies werken niet — de slager keurt zijn eigen vlees. De Ombudsman schrijft rapporten die in laden verdwijnen. Bezwaarprocedures kosten jaren. <strong>Elke formele weg die de burger heeft, loopt dood.</strong>' +
      '</p>' +
    '</div>' +

    // DE RUTTE DOCTRINE
    '<div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid var(--yellow)">' +
      '<h2 style="font-size:17px;margin-bottom:10px"><span class="mi mi-sm" style="color:var(--yellow)">history_edu</span> De Rutte Doctrine — het voorbeeld van bovenaf</h2>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Als je wilt begrijpen waarom ambtenaren zich onaantastbaar voelen, kijk dan naar de top. Mark Rutte — de langstzittende premier van Nederland — perfectioneerde het ontlopen van verantwoordelijkheid tot een <strong>bestuursdoctrine</strong>.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'De <strong>Rutte Doctrine</strong>: geen notulen, geen sms\'jes bewaren, "geen actieve herinnering", alles informeel afhandelen zodat er geen papieren spoor is. Het doel? Dat niemand ooit ergens op kan worden aangesproken. Een premier die de transparantie van het landsbestuur actief saboteerde.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'En laten we niet vergeten: Rutte is <strong>veroordeeld voor discriminatie</strong>. Het kabinet-Rutte III trad af vanwege de toeslagenaffaire — een schandaal waarin tienduizenden ouders, veelal met een migratieachtergrond, systematisch werden geruïneerd door hun eigen overheid. De rechtbank oordeelde dat er sprake was van institutionele discriminatie en etnisch profileren.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Wat was de consequentie? Hij trad af op vrijdag en was op maandag <strong>demissionair premier</strong>. Hij bleef gewoon zitten. Vervolgens werd hij <strong>secretaris-generaal van de NAVO</strong>. Gepromoveerd.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:0">' +
        'Dát is het signaal dat ambtenaren krijgen van bovenaf: <strong>je kunt levens verwoesten en er beter uitkomen dan je erin ging.</strong> Als de premier wegkomt met discriminatie en het wissen van bewijsmateriaal, waarom zou een teamleider bij het UWV of een baliemedewerker bij de gemeente zich dan wél verantwoordelijk voelen? De vis rot aan de kop — en die kop heeft laten zien dat verantwoording een optie is, geen verplichting.' +
      '</p>' +
    '</div>' +

    // ==========================================
    // OPLOSSING 1: NAMING & SHAMING
    // ==========================================
    '<div style="margin:24px 0 10px;display:flex;align-items:center;gap:10px">' +
      '<div style="height:2px;flex:1;background:linear-gradient(90deg,transparent,var(--accent))"></div>' +
      '<span style="font-size:12px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:1px;white-space:nowrap">Oplossing 1 — Overheid</span>' +
      '<div style="height:2px;flex:1;background:linear-gradient(90deg,var(--accent),transparent)"></div>' +
    '</div>' +

    '<div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid var(--accent)">' +
      '<h2 style="font-size:19px;margin-bottom:10px"><span class="mi mi-sm" style="color:var(--accent)">lightbulb</span> De enige oplossing</h2>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Er zijn al genoeg rapporten geschreven. Genoeg commissies geweest. Genoeg excuses gemaakt. <strong>Niets veranderde.</strong> Want er waren geen consequenties.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Naming and shaming is niet netjes. Wij weten dat. Maar wat is het alternatief? Nog een klacht indienen bij een klachtcommissie die bestaat uit collega\'s van de persoon over wie je klaagt? Nog een bezwaarprocedure van twee jaar? Nog een rapport dat in een la verdwijnt?' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:0">' +
        '<strong>Transparantie is de enige taal die macht begrijpt.</strong> Als ambtenaren weten dat hun naam publiek verschijnt wanneer ze de fout ingaan, denken ze twee keer na. Dat is geen bedreiging — dat is verantwoording. Dat is hoe een democratie hoort te werken.' +
      '</p>' +
    '</div>' +

    // AMBTENAREN MOETEN ELKAAR AANSPREKEN
    '<div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid var(--purple)">' +
      '<h2 style="font-size:17px;margin-bottom:10px"><span class="mi mi-sm" style="color:var(--purple)">groups</span> Ambtenaren moeten elkaar aanspreken</h2>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'In een gezonde organisatie spreken collega\'s elkaar aan op verkeerd gedrag. Dat is geen verraad — dat is <strong>professionaliteit</strong>. Een chirurg die een collega een fout ziet maken en niks zegt, is medeplichtig. Dat geldt voor elke professie. Behalve, blijkbaar, voor ambtenaren.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'In de ambtelijke cultuur heerst een <strong>zwijgcultuur</strong>. "Zo doen we dat hier." "Dat is altijd zo geweest." "Bemoei je met je eigen werk." De groep beschermt zichzelf, dissenters worden uitgestoten, misstanden worden genormaliseerd.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        '<strong>Ambtenaren moeten zelf ook hun collega\'s aanspreken.</strong> Dat is hun professionele plicht. Als jij ziet dat je collega een burger onterecht afwijst, een dossier manipuleert of instructies geeft om "ze gewoon af te keuren" — dan ben je niet alleen getuige, dan ben je medeverantwoordelijk als je zwijgt.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:0">' +
        'Maar we zijn realistisch: intern aanspreken is moeilijk als de groepsdruk te sterk is. Daarom bestaat dit platform. Het publiek spreekt aan waar collega\'s zwijgen. <strong>En als genoeg mensen dezelfde naam noemen, kan ook de leidinggevende het niet meer negeren.</strong> Extern zichtbaar wangedrag dwingt intern gesprek af. Maar uiteindelijk moet de ambtenaar zelf ook de moed hebben om te zeggen: dit klopt niet.' +
      '</p>' +
    '</div>' +

    // DE VERANTWOORDINGSKETEN
    '<div class="card" style="padding:24px;margin-bottom:16px">' +
      '<h2 style="font-size:17px;margin-bottom:12px"><span class="mi mi-sm" style="color:var(--accent)">account_tree</span> Verantwoording leggen waar het hoort</h2>' +
      '<div style="display:grid;gap:12px">' +
        '<div style="display:flex;gap:14px;align-items:flex-start">' +
          '<div style="min-width:40px;height:40px;border-radius:50%;background:var(--accent-soft);border:2px solid var(--accent);display:flex;align-items:center;justify-content:center"><span class="mi mi-sm" style="color:var(--accent)">close</span></div>' +
          '<div><div style="font-size:14px;font-weight:700;margin-bottom:2px">Nu: verantwoording verdampt</div><div style="font-size:13px;color:var(--tx2)">Burger klaagt &rarr; klachtcommissie bestaande uit collega\'s &rarr; ongegrond verklaard &rarr; minister zegt sorry in de Kamer &rarr; ambtenaar blijft zitten &rarr; niets verandert.</div></div>' +
        '</div>' +
        '<div style="display:flex;gap:14px;align-items:flex-start">' +
          '<div style="min-width:40px;height:40px;border-radius:50%;background:var(--green-soft);border:2px solid var(--green);display:flex;align-items:center;justify-content:center"><span class="mi mi-sm" style="color:var(--green)">check</span></div>' +
          '<div><div style="font-size:14px;font-weight:700;margin-bottom:2px">Straks: verantwoording bij de persoon</div><div style="font-size:13px;color:var(--tx2)">Burger meldt naam + verhaal &rarr; naam verschijnt publiek &rarr; meerdere meldingen over dezelfde persoon &rarr; patroon wordt zichtbaar &rarr; collega\'s, leidinggevenden en media <em>moeten</em> reageren &rarr; ambtenaren spreken elkaar aan &rarr; gedrag verandert.</div></div>' +
        '</div>' +
      '</div>' +
    '</div>' +

    // VOOR AMBTENAREN / KLOKKENLUIDERS
    '<div class="card" style="padding:24px;margin-bottom:16px;background:var(--purple-soft);border:1px solid rgba(168,85,247,.25)">' +
      '<h2 style="font-size:17px;margin-bottom:10px"><span class="mi mi-sm" style="color:var(--purple)">shield</span> Ook voor ambtenaren</h2>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Niet alle ambtenaren zijn het probleem. Veel ambtenaren <em>lijden</em> onder hetzelfde systeem. Ze zien dagelijks dingen die niet kloppen. Collega\'s die burgers als nummers behandelen. Leidinggevenden die wegkijken. Protocollen die onmenselijk zijn.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:0">' +
        'Dit platform biedt een uitweg. <strong>Volledig anoniem</strong> melden wat er intern misgaat. Geen IP-logging, geen tracking, data blijft lokaal. Je hoeft niet je baan te riskeren. Je hoeft alleen te vertellen wat je ziet. Maar vergeet niet: <strong>je hebt ook de plicht om intern je mond open te doen.</strong> Dit platform is een aanvulling, geen vervanging van je eigen verantwoordelijkheid.' +
      '</p>' +
    '</div>' +

    // ==========================================
    // OPLOSSING 2: NIEUW BSN
    // ==========================================
    '<div style="margin:28px 0 10px;display:flex;align-items:center;gap:10px">' +
      '<div style="height:2px;flex:1;background:linear-gradient(90deg,transparent,var(--yellow))"></div>' +
      '<span style="font-size:12px;font-weight:700;color:var(--yellow);text-transform:uppercase;letter-spacing:1px;white-space:nowrap">Oplossing 2 — Slachtoffers</span>' +
      '<div style="height:2px;flex:1;background:linear-gradient(90deg,var(--yellow),transparent)"></div>' +
    '</div>' +

    '<div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid var(--yellow)">' +
      '<h2 style="font-size:19px;margin-bottom:10px"><span class="mi mi-sm" style="color:var(--yellow)">credit_card</span> Nieuw BSN voor slachtoffers</h2>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Een van onze concrete doelen: een <strong>nieuw BSN-nummer</strong> voor alle slachtoffers van overheidsonrecht. De toeslagenaffaire, de FSV-lijsten, etnisch profileren — al deze slachtoffers hebben een BSN dat besmet is.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Hun nummer staat gemarkeerd in systemen van de Belastingdienst, banken, verzekeraars, woningcorporaties. Ze worden <em>nog steeds</em> gediscrimineerd en benadeeld op basis van een nummer dat gekoppeld is aan het onrecht dat <em>hen</em> is aangedaan.' +
      '</p>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:0">' +
        'Een nieuw BSN is een schone lei. Geen vlaggetjes meer. Geen automatische verdachtmakingen. Het is het <strong>minimale</strong> wat de overheid kan doen.' +
      '</p>' +
    '</div>' +

    // VAN HUFFELEN ZEGT DAT HET NIET KAN
    '<div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid var(--accent)">' +
      '<h2 style="font-size:17px;margin-bottom:10px"><span class="mi mi-sm" style="color:var(--accent)">gavel</span> "Kan niet" — jawel, het kan wél</h2>' +
      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:10px">' +
        'Staatssecretaris Van Huffelen zei dat een nieuw BSN niet mogelijk is. Haar argumenten: het lost niks op, het geeft regeldruk, het systeem kan het niet aan. <strong>Dat klopt niet.</strong>' +
      '</p>' +

      '<div style="background:var(--bg2);border-radius:var(--rs);padding:16px;margin-bottom:12px">' +
        '<div style="font-size:12px;font-weight:700;color:var(--blue);text-transform:uppercase;margin-bottom:8px"><span class="mi mi-sm">menu_book</span> Juridische basis</div>' +

        '<div style="font-size:13px;color:var(--tx);line-height:1.8;margin-bottom:8px">' +
          '<strong style="color:var(--yellow)">1. Getuigenbescherming — het kan al.</strong><br>' +
          'Op basis van <strong>artikel 226l Wetboek van Strafvordering</strong> en het <strong>Besluit getuigenbescherming</strong> krijgen getuigen nu al een volledig nieuwe identiteit inclusief nieuwe documenten. Als de overheid dit kan voor getuigen van misdrijven, kan ze het ook voor slachtoffers van overheidsmisdrijven.' +
        '</div>' +

        '<div style="font-size:13px;color:var(--tx);line-height:1.8;margin-bottom:8px">' +
          '<strong style="color:var(--yellow)">2. Wet BRP & Wabb — de overheid beheert het systeem zelf.</strong><br>' +
          'De <strong>Wet algemene bepalingen burgerservicenummer (Wabb)</strong> bepaalt in artikel 3 dat de Minister van BZK verantwoordelijk is voor het creëren en toekennen van nummers. <strong>Artikel 4 Wabb</strong> regelt het wijzigen en verwijderen van administratieve gegevens in het nummerregister. De wet staat het toe — er is alleen politieke wil nodig.' +
        '</div>' +

        '<div style="font-size:13px;color:var(--tx);line-height:1.8;margin-bottom:8px">' +
          '<strong style="color:var(--yellow)">3. AVG / Europees recht — het móét zelfs.</strong><br>' +
          '<strong>Artikel 16 AVG</strong>: recht op rectificatie van onjuiste persoonsgegevens — een BSN dat gekoppeld is aan een onterechte fraudemarkering bevat onjuiste informatie.<br>' +
          '<strong>Artikel 17 AVG</strong>: recht op vergetelheid — gegevens die onrechtmatig verwerkt zijn moeten gewist worden.<br>' +
          '<strong>Artikel 22 AVG</strong>: bescherming tegen geautomatiseerde besluitvorming en profilering — precies wat er met FSV-lijsten is gebeurd.' +
        '</div>' +

        '<div style="font-size:13px;color:var(--tx);line-height:1.8;margin-bottom:0">' +
          '<strong style="color:var(--yellow)">4. Identiteitsfraude-precedent.</strong><br>' +
          'Bij identiteitsfraude kan een BSN wél worden gewijzigd. Advocaat Khadija Bozia stelde: een besmet BSN door etnisch profileren is vergelijkbaar met identiteitsfraude — je nummer is gekaapt, niet door een crimineel, maar door de overheid zelf. Amnesty International classificeerde de toeslagenaffaire als een <strong>mensenrechtenschending</strong>.' +
        '</div>' +
      '</div>' +

      '<p style="font-size:14px;line-height:1.8;color:var(--tx);margin-bottom:0">' +
        'Het argument "het kan niet" is een politiek argument, geen juridisch argument. De wetten bestaan. De precedenten bestaan. De Europese regels <em>verplichten</em> het zelfs. <strong>Het enige wat ontbreekt is de wil.</strong>' +
      '</p>' +
    '</div>' +

    // SAMENVATTING
    '<div class="card" style="padding:24px;margin-bottom:16px;background:var(--accent-soft);border:1px solid rgba(239,68,68,.25)">' +
      '<h2 style="font-size:17px;margin-bottom:10px;color:var(--accent)">Samengevat</h2>' +
      '<div style="font-size:14px;line-height:1.8;color:var(--tx)">' +
        '<strong>Het probleem:</strong> Ambtenaren opereren anoniem, voelen zich niet persoonlijk verantwoordelijk, spreken elkaar niet aan, en worden niet gecorrigeerd.<br><br>' +
        '<strong>Oplossing 1 — Overheid:</strong> Naming and shaming. Namen publiceren. Patronen blootleggen. Externe druk die interne verandering afdwingt. Ambtenaren die zelf ook hun collega\'s aanspreken.<br><br>' +
        '<strong>Oplossing 2 — Slachtoffers:</strong> Nieuw BSN voor iedereen die door de overheid is benadeeld. De wet staat het toe. De AVG verplicht het. Alleen de politieke wil ontbreekt.<br><br>' +
        '<strong>Het doel:</strong> Een overheid waar ambtenaren elkaar aanspreken op gedrag, waar burgers niet permanent gestraft worden voor fouten van het systeem, en waar 1 naam al genoeg is om het verschil te maken.' +
      '</div>' +
    '</div>' +

    // CTA
    '<div style="text-align:center;padding:20px 0">' +
      '<h3 style="font-size:17px;margin-bottom:6px">Wil jij je recht halen?</h3>' +
      '<p style="font-size:13px;color:var(--tx2);margin-bottom:14px">Wij helpen je om de daders verantwoordelijk te houden. <strong style="color:var(--accent)">1 naam is al genoeg.</strong></p>' +
      '<div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">' +
        '<button class="btn btn-red btn-lg" onclick="go(\'/melden\')"><span class="mi">add_circle</span> Doe een melding</button>' +
        '<button class="btn btn-purple" onclick="go(\'/klokkenluider\')"><span class="mi mi-sm">shield</span> Klokkenluider</button>' +
      '</div>' +
    '</div>' +
  '</div>';
}

// ============ DEMO DATA ============
function seedDemo(){
  if(DS.count('meldingen') > 0) return;

  DS.add('meldingen', {
    titel: 'Vijf jaar later nog steeds op zwarte lijst',
    verhaal: 'In 2014 werd mijn kinderopvangtoeslag stopgezet en moest ik meer dan 40.000 euro terugbetalen. Geld dat ik niet had. Ik verloor mijn huis, mijn huwelijk liep stuk, en mijn kinderen groeiden op in armoede.\n\nIn 2021 werd ik erkend als slachtoffer. Ik kreeg 30.000 euro compensatie. Maar mijn BSN-nummer staat nog steeds gemarkeerd in systemen. Elke keer als ik een hypotheek aanvraag, een verzekering afsluit of een uitkering aanvraag, gaat er een vlaggetje omhoog.\n\nIk ben geen fraudeur. Dat ben ik nooit geweest. Maar mijn BSN vertelt een ander verhaal.',
    instantie: 'Belastingdienst / Toeslagen',
    namen: [],
    anoniem: false, melder_naam: 'Fatima E.', klokkenluider: false,
    ts: Date.now() - 3*86400000, views: 456
  });

  DS.add('meldingen', {
    titel: 'Deurwaarder kwam voor schuld die al vergeven was',
    verhaal: 'Twee weken geleden stond er een deurwaarder voor mijn deur. Voor een schuld bij de Belastingdienst van 12.000 euro. Deze schuld zou kwijtgescholden zijn als onderdeel van de toeslagenaffaire-compensatie.\n\nNa 6 uur bellen bleek dat het systeem de kwijtschelding niet had verwerkt. Zes uur bellen. Voor een fout van de overheid. Terwijl mijn kinderen angstig in de gang stonden.',
    instantie: 'Belastingdienst',
    namen: [{ naam: 'K. Hendriksen', functie: 'Invorderingsambtenaar' }],
    anoniem: true, klokkenluider: false,
    ts: Date.now() - 1*86400000, views: 234
  });

  DS.add('meldingen', {
    titel: 'Al 4 jaar wachten op versterkingsoperatie',
    verhaal: 'Ons huis is in 2020 geinspecteerd en beoordeeld als onveilig vanwege aardbevingsschade. We zouden binnen een jaar versterkt worden.\n\nHet is nu 2025 en er is nog niks gebeurd. We wonen met twee kleine kinderen in een huis waarvan de overheid zelf zegt dat het onveilig is. Elke keer als we bellen krijgen we een ander verhaal.',
    instantie: 'Nationaal Coordinator Groningen (NCG)',
    namen: [],
    anoniem: false, melder_naam: 'Familie de Boer', klokkenluider: false,
    ts: Date.now() - 4*86400000, views: 189
  });

  DS.add('meldingen', {
    titel: 'Kinderen uithuisgeplaatst op basis van leugens',
    verhaal: 'Op 12 september 2023 zijn mijn twee kinderen uithuisgeplaatst door Jeugdbescherming. Het rapport bevatte aantoonbare onwaarheden.\n\nDe gezinsvoogd had nooit met mij gesproken maar schreef dat ik niet meewerkte. Buren die positief verklaarden werden niet in het rapport opgenomen.\n\nHet heeft 14 maanden geduurd voordat de kinderrechter besloot dat de uithuisplaatsing onterecht was.',
    instantie: 'Jeugdbescherming West',
    namen: [{ naam: 'L. van Dijk', functie: 'Gezinsvoogd' }],
    anoniem: false, melder_naam: 'Sarah M.', klokkenluider: false,
    ts: Date.now() - 6*86400000, views: 678
  });

  DS.add('meldingen', {
    titel: 'Bouwaanvraag 8 maanden zonder reactie',
    verhaal: 'Op 14 maart 2024 heb ik een bouwaanvraag ingediend voor een dakkapel. De wettelijke termijn is 8 weken. Het is nu meer dan 8 maanden later en ik heb nog steeds geen reactie.\n\nIk heb 6 keer gebeld. Elke keer word ik doorverbonden naar iemand anders die belooft terug te bellen. Dat gebeurt nooit.',
    instantie: 'Gemeente Voorburg',
    namen: [{ naam: 'J. van der Berg', functie: 'Behandelaar omgevingsvergunningen' }],
    anoniem: false, melder_naam: 'Peter Janssen', klokkenluider: false,
    ts: Date.now() - 2*86400000, views: 127
  });

  DS.add('meldingen', {
    titel: 'Discriminatie bij loket Burgerzaken',
    verhaal: 'De medewerker achter het loket weigerde mij in het Nederlands te woord te staan en sprak mij aan in het Engels, ondanks dat ik in accentloos Nederlands had gesproken.\n\nToen ik bezwaar maakte werd mij verteld dat ik achteraan moest aansluiten. Andere bezoekers die na mij waren binnengekomen werden wel direct geholpen.',
    instantie: 'Gemeente Den Haag',
    namen: [{ naam: 'A. de Groot', functie: 'Baliemedewerker Burgerzaken' }],
    anoniem: true, klokkenluider: false,
    ts: Date.now() - 5*86400000, views: 89
  });

  DS.add('meldingen', {
    titel: 'Intern memo: keur ze gewoon af',
    verhaal: 'Ik werk bij het UWV als verzekeringsarts. Er is een informeel beleid om bij twijfel altijd af te keuren in plaats van toe te kennen. Dit wordt niet op papier gezet maar wel zo gecommuniceerd door teamleiders.\n\nMijn collega R. de Vries zei letterlijk in een teamoverleg: "bij twijfel afkeuren, dat scheelt ons een herkeuring." Dit gaat over mensen hun inkomen.',
    instantie: 'UWV',
    namen: [{ naam: 'R. de Vries', functie: 'Teamleider keuringen' }],
    anoniem: true, klokkenluider: true,
    ts: Date.now() - 7*86400000, views: 891
  });
}

// ============ INIT ============
seedDemo();
parseRoute();
console.log('Meldpunt Ambtenaren v2.0');
</script>
</body>
</html>
